---
title: "Amazon SageMaker Geospatial ML AwsAdventCalendar"
emoji: "ğŸš´ğŸ»â€â™€ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws","æ„Ÿæƒ³","AiMlOnAwsAdventCalendar2022"]
published: true
---
# ã¯ã˜ã‚ã«

ã“ã®ãƒ–ãƒ­ã‚°ã¯[AI/ML on AWS Advent Calendar 2022](https://qiita.com/advent-calendar/2022/ai-ml-on-aws)ã®6æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚  
  
re:invent2022ã§ç™ºè¡¨ã•ã‚ŒãŸAmazon SageMaker Geospatial MLã«ã¤ã„ã¦æ•´ç†ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚
åˆ¥é€”[ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©¦ã—ãŸè¨˜äº‹](https://zenn.dev/shigeru_oda/articles/3365fc254942d9fa122e)ã¯æ—¢ã«ã‚ã‚‹ã®ã§ã™ãŒã€ä¸æ˜ç‚¹ã‚‚ã‚ã‚Šå†æ•´ç†ã—ãŸã„å†…å®¹ã¨ãªã‚Šã¾ã™ã€‚

# Sagemaker Geospatialã£ã¦ãªã«ï¼Ÿ

åœ°ç†ç©ºé–“æ©Ÿæ¢°å­¦ç¿’(ML)ã‚µãƒãƒ¼ãƒˆã—ã€åœ°ç†ç©ºé–“ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ãŸãƒ¢ãƒ‡ãƒ«ã®æ§‹ç¯‰ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®¹æ˜“ã¨ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã€‚AWSãŒæä¾›ã™ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆ[USGS Landsat](https://registry.opendata.aws/usgs-landsat/)ã€[Sentinel-2](https://registry.opendata.aws/sentinel-2-l2a-cogs/)ï¼‰ã€ã¾ãŸã¯è¡›ç”Ÿç”»åƒãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»åœ°å›³æƒ…å ±ãƒ»GPSãªã©ã‚’æŒã¡è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€äº‹å‰ã«å­¦ç¿’ã—ãŸMLãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã¦ã€ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ã‚’åŠ é€Ÿã€‚äºˆæ¸¬çµæœã«å¯¾ã—ã¦åœ°å›³ä¸Šã§åˆ†æãƒ»æ¢ç´¢ã—ã€çµæœã‚’å…±æœ‰ãƒ»å…±åŒä½œæ¥­ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚  
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã¯è‡ªç„¶ç½å®³ã«ã‚ˆã‚‹åœ°åŸŸçµŒæ¸ˆã¸ã®å½±éŸ¿åˆ†æã€å»ºè¨­ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½è·¡ã€ä½ã¿ã‚„ã™ã„éƒ½å¸‚ç’°å¢ƒã®è¨­è¨ˆãªã©ã«ç”¨ã„ã‚‰ã‚Œã‚‹

# Sagemaker GeospatialãŒã‚„ã‚Œã‚‹ã“ã¨

## â– IAM Policyã§ç¢ºèª

![](https://storage.googleapis.com/zenn-user-upload/4acf8c5abfe1-20221202.png)
ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ã¯ä»¥ä¸‹3ç‚¹ã®ã‚ˆã†ã§ã™ã€æ„å‘³ã¯å¾Œè¿°

- EarthObservationJobs
- VectorEnrichmentJobs
- RasterDataCollections

## â– Amazon SageMaker Studioã§ç¢ºèª

![](https://storage.googleapis.com/zenn-user-upload/105d4f9ca690-20221202.png)
ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ã¯ä»¥ä¸‹4ç‚¹ã®ã‚ˆã†ã§ã™ã€æ„å‘³ã¯å¾Œè¿°

- Earth Observation jobs
- Vector Enrichment jobs
- Map Visualization
- Geospatial Notebooks

## â– æ•´ç†

| ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ | èª¬æ˜ |
| ---- | ---- |
| Earth Observation jobs | åœ°çƒè¡¨é¢ã‹ã‚‰åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å¤‰æ›ã—ã€å¯è¦–åŒ–ã—ã¦ã€æ´å¯Ÿã‚„äºˆæ¸¬ã‚’è¡Œã†ã€‚ |
| Vector Enrichment jobs | Amazon Location Services ã‚’ä½¿ç”¨ã—ã¦ã€åœ°å›³åº§æ¨™ã‚’äººé–“ã®èª­ã¿ã‚„ã™ã„ä½æ‰€ã«é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¾ã™ã€‚ä¸æ­£ç¢ºãªçµŒåº¦ã¨ç·¯åº¦ã‚’æ—¢çŸ¥ã®é“è·¯ç¶²ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ã‚¹ãƒŠãƒƒãƒ—ã—ã¦ã€ãƒãƒƒãƒ—ãƒãƒƒãƒãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç† | Text |
| Raster Data Collections | [USGS Landsat](https://registry.opendata.aws/usgs-landsat/)ã€[Sentinel-2](https://registry.opendata.aws/sentinel-2-l2a-cogs/)ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ |
| Map Visualization | Amazon S3ã‹ã‚‰CSVã€JSONã€GeoJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å¼·åŠ›ãªå¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ |
| Geospatial Notebooks | GDALã€Fionaã€GeoPandasã€Shapelyã€Rasterioãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„SageMakerå›ºæœ‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã€åœ°ç†ç©ºé–“ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯å†…ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›ã—ã€å¯è¦–åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ |

# Roleãƒ»Policyã«ã¤ã„ã¦

`sagemaker`ã¨`sagemaker-geospatial`ã¯åˆ¥ã‚«ãƒ†ã‚´ãƒªã§APIã‚„IAMã¯æ•´ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¿¡é ¼é–¢ä¿‚ã‚„è¨±å¯ã«ã¤ã„ã¦ã¯å¿…è¦ã«å¿œã˜ã¦æ›´æ–°ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€è©³ç´°ã¯ãƒªãƒ³ã‚¯å…ˆå‚ç…§
<https://docs.aws.amazon.com/sagemaker/latest/dg/sagemaker-geospatial-roles.html>

# Earth Observation jobsã‚’ã‚„ã£ã¦ã¿ã‚‹

ç¹°ã‚Šè¿”ã—ã¨ãªã‚Šã¾ã™ãŒã€æ©Ÿèƒ½ã¨ã—ã¦ã¯ã€Œåœ°çƒè¡¨é¢ã‹ã‚‰åé›†ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å¤‰æ›ã—ã€å¯è¦–åŒ–ã—ã¦ã€æ´å¯Ÿã‚„äºˆæ¸¬ã‚’è¡Œã†ã€‚ã€ã¨ãªã‚Šã¾ã™ã€‚jobãŒè¡Œãˆã‚‹ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã§ã™ã€‚  
ã¡ãªã¿ã«Raster Data Collectionsã¯USGS Landsatã€Sentinel-2ã®2ã¤ã‚ã‚‹ãŒã€å…¨ã¦ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨ã§ãã‚‹è¨³ã§ã¯ãªã„ã§ã™ã€ä»Šå›ã¯"ã‚¯ãƒ©ã‚¦ãƒ‰é™¤å»"ã‚’å®Ÿæ–½ã—ã¾ã™ãŒUSGS Landsatã‚’åˆ©ç”¨ã—ã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/b245f6025010-20221203.png)

## â– search-raster-data-collection

æ¡ä»¶ã«åˆã†ç”»åƒãŒRaster Data Collectionsã«ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚ã€äº‹å‰ã«èª¿æŸ»ã‚’è¡Œã„ã¾ã™ã€‚

### cli-input-jsonã‚’æº–å‚™

:::details cli-input-json

```
{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378778860802:raster-data-collection/public/gmqa64dcu2g9ayx1",
    "RasterDataCollectionQuery": {
        "TimeRangeFilter": {
            "StartTime": "2022-01-01T00:00:00Z",
            "EndTime": "2022-11-30T23:59:59Z"
        },
        "AreaOfInterest": {
            "AreaOfInterestGeometry": {
                "PolygonGeometry": {
                    "Coordinates": [
                        [
                              [
                                139.720509,
                                35.635363
                              ],
                              [
                                139.720787,
                                35.628579
                              ],
                              [
                                139.711368,
                                35.62891
                              ],
                              [
                                139.711625,
                                35.634561
                              ],
                              [
                                139.711625,
                                35.635136
                              ],
                              [
                                139.720509,
                                35.635363
                              ]
                        ]
                    ]
                }
            }
        },
        "PropertyFilters": {
            "Properties": [
                {
                    "Property": {
                        "LandsatCloudCoverLand": {
                            "LowerBound": 0.0,
                            "UpperBound": 20.0
                        }
                    }
                }
            ],
            "LogicalOperator": "AND"
        }
    }
}
```

:::

### cmd

```
!aws sagemaker-geospatial search-raster-data-collection --cli-input-json file://srdc.json
```

### result

14å€‹ã®çµæœãŒå–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

```
{
    "ApproximateResultCount": 14,
    ç•¥
}
```

## â– start-earth-observation-job

### cli-input-jsonã‚’æº–å‚™

:::details cli-input-json
```
{
    "Name": "otameshi-1",
    "InputConfig": {
        "RasterDataCollectionQuery": {
            "RasterDataCollectionArn": "arn:aws:sagemaker-geospatial:us-west-2:378778860802:raster-data-collection/public/gmqa64dcu2g9ayx1",
            "TimeRangeFilter": {
                "StartTime": "2022-01-01T00:00:00Z",
                "EndTime": "2022-11-30T23:59:59Z"
            },
            "AreaOfInterest": {
                "AreaOfInterestGeometry": {
                    "PolygonGeometry": {
                        "Coordinates": [
                            [
                              [
                                139.720509,
                                35.635363
                              ],
                              [
                                139.720787,
                                35.628579
                              ],
                              [
                                139.711368,
                                35.62891
                              ],
                              [
                                139.711625,
                                35.634561
                              ],
                              [
                                139.711625,
                                35.635136
                              ],
                              [
                                139.720509,
                                35.635363
                              ]
                            ]
                        ]
                    }
                }
            },
            "PropertyFilters": {
                "Properties": [
                    {
                        "Property": {
                            "LandsatCloudCoverLand": {
                                "LowerBound": 0.0,
                                "UpperBound": 20.0
                            }
                        }
                    }
                ],
                "LogicalOperator": "AND"
            }
        }
    },
    "JobConfig": {
        "CloudRemovalConfig": {
            "AlgorithmName": "INTERPOLATION"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439"
}
```
:::

### cmd

```
!aws sagemaker-geospatial start-earth-observation-job --cli-input-json file://seoj.json
```

### result
:::details result
```
{
    "Name": "otameshi-1",
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:earth-observation-job/rwrjjc7dtvw3",
    "CreationTime": "2022-12-04T12:37:04.354625+00:00",
    "DurationInSeconds": 0,
    "Status": "INITIALIZING",
    "InputConfig": {
        "RasterDataCollectionQuery": {
            "RasterDataCollectionArn": "arn:aws:sagemaker-geospatial:us-west-2:378778860802:raster-data-collection/public/gmqa64dcu2g9ayx1",
            "RasterDataCollectionName": "Landsat Collection 2 Level-2 Science Products",
            "TimeRangeFilter": {
                "StartTime": "2022-01-01T00:00:00Z",
                "EndTime": "2022-11-30T23:59:59Z"
            },
            "AreaOfInterest": {
                "AreaOfInterestGeometry": {
                    "PolygonGeometry": {
                        "Coordinates": [
                            [
                                [
                                    139.720509,
                                    35.635363
                                ],
                                [
                                    139.720787,
                                    35.628579
                                ],
                                [
                                    139.711368,
                                    35.62891
                                ],
                                [
                                    139.711625,
                                    35.634561
                                ],
                                [
                                    139.711625,
                                    35.635136
                                ],
                                [
                                    139.720509,
                                    35.635363
                                ]
                            ]
                        ]
                    }
                }
            },
            "PropertyFilters": {
                "Properties": [
                    {
                        "Property": {
                            "LandsatCloudCoverLand": {
                                "LowerBound": 0.0,
                                "UpperBound": 20.0
                            }
                        }
                    }
                ],
                "LogicalOperator": "AND"
            }
        }
    },
    "JobConfig": {
        "CloudRemovalConfig": {
            "AlgorithmName": "INTERPOLATION"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}
```
:::


## â– get-earth-observation-job
start-earth-observation-jobã§å¾—ãŸArnã‚’åˆ©ç”¨ã—ã¾ã™
### cmd
```
!aws sagemaker-geospatial get-earth-observation-job --arn "arn:aws:sagemaker-geospatial:us-west-2:378647896848:earth-observation-job/rwrjjc7dtvw3"
```

### result
30åˆ†è¿‘ãè¦ã—ã¾ã—ãŸãŒã€æ­£å¸¸çµ‚äº†
:::details result
```
{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:earth-observation-job/rwrjjc7dtvw3",
    "Name": "otameshi-1",
    "CreationTime": "2022-12-04T12:37:04.354625+00:00",
    "DurationInSeconds": 1720,
    "Status": "COMPLETED",
    "InputConfig": {
        "RasterDataCollectionQuery": {
            "RasterDataCollectionArn": "arn:aws:sagemaker-geospatial:us-west-2:378778860802:raster-data-collection/public/gmqa64dcu2g9ayx1",
            "RasterDataCollectionName": "Landsat Collection 2 Level-2 Science Products",
            "TimeRangeFilter": {
                "StartTime": "2022-01-01T00:00:00Z",
                "EndTime": "2022-11-30T23:59:59Z"
            },
            "AreaOfInterest": {
                "AreaOfInterestGeometry": {
                    "PolygonGeometry": {
                        "Coordinates": [
                            [
                                [
                                    139.720509,
                                    35.635363
                                ],
                                [
                                    139.720787,
                                    35.628579
                                ],
                                [
                                    139.711368,
                                    35.62891
                                ],
                                [
                                    139.711625,
                                    35.634561
                                ],
                                [
                                    139.711625,
                                    35.635136
                                ],
                                [
                                    139.720509,
                                    35.635363
                                ]
                            ]
                        ]
                    }
                }
            },
            "PropertyFilters": {
                "Properties": [
                    {
                        "Property": {
                            "LandsatCloudCoverLand": {
                                "LowerBound": 0.0,
                                "UpperBound": 20.0
                            }
                        }
                    }
                ],
                "LogicalOperator": "AND"
            }
        }
    },
    "JobConfig": {
        "CloudRemovalConfig": {
            "AlgorithmName": "INTERPOLATION",
            "InterpolationValue": "-9999"
        }
    },
    "OutputBands": [
        {
            "BandName": "coastal",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "blue",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "green",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "red",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "nir",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "swir16",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "swir22",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "qa_aerosol",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "qa_pixel",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "qa_radsat",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "lwir11",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "atran",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "cdist",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "drad",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "urad",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "trad",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "emis",
            "OutputDataType": "FLOAT32"
        },
        {
            "BandName": "emsd",
            "OutputDataType": "FLOAT32"
        }
    ],
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}
```
:::

## â– çµæœ
#### input
å·¦å´ã«é›²ç”»åƒãŒè¦‹ãˆã‚‹ã‹ã¨æ€ã„ã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/e1e968cb1616-20221204.png)

#### input
é›²ã‚’é™¤å»ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã„ã‚ã‚“ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã‚ã‚‹ã‘ã©ã‚¤ãƒã‚¤ãƒã‚ã‹ã‚‰ã‚“ã€‚
![](https://storage.googleapis.com/zenn-user-upload/d3ef4b03bcd9-20221204.png)

# Vector Enrichment jobsã‚’ã‚„ã£ã¦ã¿ã‚‹ï¼ˆé€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼‰

ãƒªãƒãƒ¼ã‚¹ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ãƒãƒƒãƒ—ãƒãƒƒãƒãƒ³ã‚°ã®2ã¤ã®æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã®ã§ã€ã¾ãšã¯é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è©¦ã—ã¾ã™ã€‚

## â– csvãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™

è»½åº¦ã¨ç·¯åº¦ã‚’è¨˜è¼‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã«UpLoadã—ã¦ãŠãã¾ã™ã€å ´æ‰€ã¯ç›®é»’ã‚»ãƒ³ãƒˆãƒ©ãƒ«ã‚¹ã‚¯ã‚¨ã‚¢ã§ã™
![](https://storage.googleapis.com/zenn-user-upload/c32b7c7b2683-20221204.png)

|No|X|Y|
|:----|:----|:----|
|1|139.7170453392394|35.633382211006634|

## â– start-vector-enrichment-job

#### cli-input-jsonã‚’æº–å‚™

JobConfig.ReverseGeocodingConfigã¯csvã®ã‚«ãƒ©ãƒ åã«åˆã‚ã›ã¾ã™ã€‚

```
{
    "Name": "otameshi-2",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/meguro.csv"
            }
        }
    },
    "JobConfig": {
        "ReverseGeocodingConfig": {
            "YAttributeName": "Y",
            "XAttributeName": "X"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439"
}
```

#### cmd

```
!aws sagemaker-geospatial start-vector-enrichment-job --cli-input-json file://svej.json
```

#### result

:::details result

```
{
    "Name": "otameshi-2",
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/rj594z2abxhh",
    "Type": "REVERSE_GEOCODING",
    "CreationTime": "2022-12-04T01:06:26.796946+00:00",
    "DurationInSeconds": 0,
    "Status": "INITIALIZING",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/meguro.csv"
            }
        }
    },
    "JobConfig": {
        "ReverseGeocodingConfig": {
            "YAttributeName": "Y",
            "XAttributeName": "X"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}
```

:::

## â– get-vector-enrichment-job

#### cmd

start-vector-enrichment-jobã§å¾—ãŸARNã‚’åˆ©ç”¨ã—ã¦get-vector-enrichment-jobã‚’å®Ÿæ–½

```
!aws sagemaker-geospatial get-vector-enrichment-job --arn "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/rj594z2abxhh"
```

#### result

:::details result

```
{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/rj594z2abxhh",
    "Type": "REVERSE_GEOCODING",
    "Name": "otameshi-2",
    "CreationTime": "2022-12-04T01:06:26.796946+00:00",
    "DurationInSeconds": 9,
    "Status": "COMPLETED",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/meguro.csv"
            }
        }
    },
    "JobConfig": {
        "ReverseGeocodingConfig": {
            "YAttributeName": "Y",
            "XAttributeName": "X"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}
:::

## â– export-vector-enrichment-job

#### cli-input-jsonã‚’æº–å‚™
Arnã¯start-vector-enrichment-jobã§å¾—ãŸArnã¨ãªã‚‹
```

{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/56u98fe5dakd",
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "OutputConfig": {
        "S3Data": {
            "S3Uri": "s3://sagemaker-us-west-2-378647896848",
            "KmsKeyId": ""
        }
    }
}

```

#### cmd
```

!aws sagemaker-geospatial export-vector-enrichment-job --cli-input-json file://evej.json

```

#### result
IN_PROGRESSã§çµæœã¯å‡ºã‚‹ãŒã€S3ã«å‡ºåŠ›ã•ã‚Œã‚‹ã¾ã§æ­£å¸¸çµ‚äº†ãƒ»ç•°å¸¸çµ‚äº†ãŒè¦‹ãˆãªã„ã®ãŒã„ã¾ã„ã¡ã€‚ã€‚ã€‚

:::details result
```

{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/rj594z2abxhh",
    "CreationTime": "2022-12-04T01:13:05.250466+00:00",
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "ExportStatus": "IN_PROGRESS",
    "OutputConfig": {
        "S3Data": {
            "S3Uri": "s3://sagemaker-us-west-2-378647896848",
            "KmsKeyId": ""
        }
    }
}

```
:::

#### s3ã®ä¸­èº«
|No|X|Y|reverse_geo.address_number|reverse_geo.country|reverse_geo.label|reverse_geo.municipality|reverse_geo.neighborhood|reverse_geo.postal_code|reverse_geo.region|reverse_geo.status|
|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|:----|
|1|139.7170453392394| 35.633382211006634|ï¼•|JPN|æ±äº¬éƒ½å“å·åŒºä¸Šå¤§å´ï¼“-ï¼‘-ï¼•| |ï¼“|1410021|æ±äº¬éƒ½|Valid Data|

#### å‡ºåŠ›çµæœã®ä½æ‰€ã‚’ç¢ºèª
æœŸå¾…é€šã‚Šã€ç›®é»’ã‚»ãƒ³ãƒˆãƒ©ãƒ«ã‚¹ã‚¯ã‚¨ã‚¢ã®ä½æ‰€ãŒå–å¾—ã§ãã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/69bf3b49d220-20221204.png)


# Vector Enrichment jobsã‚’ã‚„ã£ã¦ã¿ã‚‹ï¼ˆãƒãƒƒãƒ—ãƒãƒƒãƒãƒ³ã‚°ï¼‰
ãƒãƒƒãƒ—ãƒãƒƒãƒãƒ³ã‚°ã‚‚è©¦ã—ã¦ã¿ã¾ã™ã€‚

## â– csvãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™

Idã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã€è»½åº¦ã€ç·¯åº¦ã‚’è¨˜è¼‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã«UpLoadã—ã¦ãŠãã¾ã™ã€‚

|id|latitude|longitude|pdate|
|:----|:----|:----|:----|
|1|35.636770|139.713786|2022-12-4 10:01:00|
|2|35.636062|139.714042|2022-12-4 10:01:00|
|3|35.637651|139.713943|2022-12-4 10:01:00|
|4|35.635253|139.714373|2022-12-4 10:01:00|
|5|35.638022|139.714223|2022-12-4 10:01:00|
|6|35.637934|139.715278|2022-12-4 10:01:00|



## â– start-vector-enrichment-job

#### cli-input-jsonã‚’æº–å‚™

JobConfig.MapMatchingConfigã¯csvã®ã‚«ãƒ©ãƒ åã«åˆã‚ã›ã¾ã™ã€‚

```

{
    "Name": "otameshi-3",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/meguro2.csv"
            }
        }
    },
    "JobConfig": {
        "MapMatchingConfig": {
            "IdAttributeName": "id",
            "YAttributeName": "longitude",
            "XAttributeName": "latitude",
            "TimestampAttributeName": "pdate"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439"
}

```

#### cmd

```

!aws sagemaker-geospatial start-vector-enrichment-job --cli-input-json file://svej.json

```


#### result

:::details result
```

{
    "Name": "otameshi-3",
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/w5bqkei4a3x7",
    "Type": "MAP_MATCHING",
    "CreationTime": "2022-12-04T05:27:39.521644+00:00",
    "DurationInSeconds": 0,
    "Status": "INITIALIZING",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/data.csv"
            }
        }
    },
    "JobConfig": {
        "MapMatchingConfig": {
            "IdAttributeName": "id",
            "YAttributeName": "latitude",
            "XAttributeName": "longitude",
            "TimestampAttributeName": "pdate"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}

```
:::


## â– get-vector-enrichment-job

#### cmd
start-vector-enrichment-jobã§å¾—ãŸARNã‚’åˆ©ç”¨ã—ã¦get-vector-enrichment-jobã‚’å®Ÿæ–½
```

!aws sagemaker-geospatial get-vector-enrichment-job --arn "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/w5bqkei4a3x7"

```

#### result

:::details result
```

{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/w5bqkei4a3x7",
    "Type": "MAP_MATCHING",
    "Name": "otameshi-3",
    "CreationTime": "2022-12-04T05:27:39.521644+00:00",
    "DurationInSeconds": 104,
    "Status": "COMPLETED",
    "InputConfig": {
        "DocumentType": "CSV",
        "DataSourceConfig": {
            "S3Data": {
                "S3Uri": "s3://sagemaker-us-west-2-378647896848/data.csv"
            }
        }
    },
    "JobConfig": {
        "MapMatchingConfig": {
            "IdAttributeName": "id",
            "YAttributeName": "latitude",
            "XAttributeName": "longitude",
            "TimestampAttributeName": "pdate"
        }
    },
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "Tags": {}
}

```
:::

## â– export-vector-enrichment-job

#### cli-input-jsonã‚’æº–å‚™
Arnã¯start-vector-enrichment-jobã§å¾—ãŸArnã¨ãªã‚‹
```

{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/w5bqkei4a3x7",
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "OutputConfig": {
        "S3Data": {
            "S3Uri": "s3://sagemaker-us-west-2-378647896848",
            "KmsKeyId": ""
        }
    }
}

```

#### cmd
```

!aws sagemaker-geospatial export-vector-enrichment-job --cli-input-json file://xvej.json

```

#### result
IN_PROGRESSã§çµæœã¯å‡ºã‚‹ãŒã€S3ã«å‡ºåŠ›ã•ã‚Œã‚‹ã¾ã§æ­£å¸¸çµ‚äº†ãƒ»ç•°å¸¸çµ‚äº†ãŒè¦‹ãˆãªã„ã®ãŒã„ã¾ã„ã¡ã€‚ã€‚ã€‚

:::details result
```

{
    "Arn": "arn:aws:sagemaker-geospatial:us-west-2:378647896848:vector-enrichment-job/w5bqkei4a3x7",
    "CreationTime": "2022-12-04T05:43:42.553090+00:00",
    "ExecutionRoleArn": "arn:aws:iam::378647896848:role/service-role/AmazonSageMaker-ExecutionRole-20221117T213439",
    "ExportStatus": "IN_PROGRESS",
    "OutputConfig": {
        "S3Data": {
            "S3Uri": "s3://sagemaker-us-west-2-378647896848",
            "KmsKeyId": ""
        }
    }
}

```
:::

## â– ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ
ãƒãƒƒãƒãƒ³ã‚°ã›ãšã«ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã—ã€‚ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚ŒãŸgeojsonã‚’åãå‡ºã™ã¨æ€ã£ãŸã‘ã©ã¡ã‚ƒã†ã‚“ï¼Ÿ
![](https://storage.googleapis.com/zenn-user-upload/2b14a0bfbb86-20221204.png)
```

{"mapMatchRecords":[]}

```

# Map Visualizationã‚’ã‚„ã£ã¦ã¿ã‚‹

<https://nlftp.mlit.go.jp/index.html>

å›½åœŸäº¤é€šçœã‹ã‚‰é©å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã—ã¦é“è·¯ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã—ãŸã€‚  
ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é‡ã­ã¦é“è·¯ã¨æ°´å®³åœ°åŸŸãªã©è¡¨ç¾ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/e642174305f0-20221202.png)

# æ”¹å–„è¦æœ›

## â– ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®vector-enrichment-jobã«ã¤ã„ã¦

Earth Observation jobsã«æ¯”ã¹ã‚‹ã¨è©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªã‚„å‰Šé™¤ãŒã§ããªã„ã®ã§ã€ãƒ¬ãƒ™ãƒ«æ„Ÿã¯åˆã‚ã›ã¦æ¬²ã—ã„ã€‚

## â– export-vector-enrichment-job(é€†ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°)ã«ã¤ã„ã¦
startã‚„getã§ã¯æ­£å¸¸çµ‚äº†ã—ã¦ã„ã‚‹ãŒã€exportã®ä¸­èº«ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹å ´åˆãŒã‚ã‚‹ã€startã§å¼¾ã„ã¦æ¬²ã—ã„ã€‚


## â– export-vector-enrichment-jobã«ã¤ã„ã¦
`aws sagemaker-geospatial export-vector-enrichment-job`ã§VECã®çµæœãŒå‡ºåŠ›ã•ã‚Œã‚‹ãŒ1è¡Œãƒ‡ãƒ¼ã‚¿ã§ã‚‚å³æ™‚ã§ã¯ãªã„ã€‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒIN_PROGRESSã«ãªã‚‹ã“ã¨ã¯ç¢ºèªã§ãã‚‹ãŒã€ãã®å¾Œã«"ç•°å¸¸çµ‚äº†" or "å‡¦ç†ä¸­"ã‹ãŒæ‹¾ãˆã‚‹APIãŒç„¡ã„?ã¨æ€ã‚ã‚Œã‚‹ã€‚

## â– jobã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°ãƒ»æ¤œç´¢ã«ã¤ã„ã¦
ãƒšãƒ¼ã‚¸ãƒ³ã‚°ãŒä¸€æšç›®ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã€æ¤œç´¢ãŒåŠ¹ã„ã¦ãªã„ã€‚
```

!aws sagemaker-geospatial list-vector-enrichment-jobs | grep "Arn" | wc -l
11

```
![](https://storage.googleapis.com/zenn-user-upload/f5dd41fdfa14-20221204.png)


# å‚è€ƒè¨˜äº‹

<https://aws.amazon.com/jp/blogs/aws/preview-use-amazon-sagemaker-to-build-train-and-deploy-ml-models-using-geospatial-data/>

<https://aws.amazon.com/jp/sagemaker/geospatial/>

<https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sagemaker-geospatial/index.html>
